(function(te,W){typeof exports=="object"&&typeof module<"u"?W(exports):typeof define=="function"&&define.amd?define(["exports"],W):(te=typeof globalThis<"u"?globalThis:te||self,W(te.AnnotoriousTools={}))})(this,function(te){"use strict";var Mo=Object.defineProperty;var Yo=(te,W,Ae)=>W in te?Mo(te,W,{enumerable:!0,configurable:!0,writable:!0,value:Ae}):te[W]=Ae;var gt=(te,W,Ae)=>Yo(te,typeof W!="symbol"?W+"":W,Ae);var W=Object.defineProperty,Ae=(e,t,n)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,yt=(e,t,n)=>Ae(e,typeof t!="symbol"?t+"":t,n);function Fe(){}function tt(e,t){for(const n in t)e[n]=t[n];return e}function _t(e){return e()}function wt(){return Object.create(null)}function ae(e){e.forEach(_t)}function x(e){return typeof e=="function"}function qe(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function tn(e){return Object.keys(e).length===0}function nn(e,t,n,o){if(e){const s=Tt(e,t,n,o);return e[0](s)}}function Tt(e,t,n,o){return e[1]&&o?tt(n.ctx.slice(),e[1](o(t))):n.ctx}function on(e,t,n,o){if(e[2]&&o){const s=e[2](o(n));if(t.dirty===void 0)return s;if(typeof s=="object"){const r=[],i=Math.max(t.dirty.length,s.length);for(let a=0;a<i;a+=1)r[a]=t.dirty[a]|s[a];return r}return t.dirty|s}return t.dirty}function sn(e,t,n,o,s,r){if(s){const i=Tt(t,n,o,r);e.p(i,s)}}function rn(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let o=0;o<n;o++)t[o]=-1;return t}return-1}function bt(e){const t={};for(const n in e)n[0]!=="$"&&(t[n]=e[n]);return t}function xe(e){return e??""}function Et(e,t){e.appendChild(t)}function M(e,t,n){e.insertBefore(t,n||null)}function G(e){e.parentNode&&e.parentNode.removeChild(e)}function ln(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function J(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function $t(e){return document.createTextNode(e)}function re(){return $t(" ")}function Ot(){return $t("")}function U(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function w(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function an(e){return Array.from(e.childNodes)}function Pt(e,t,n){e.classList.toggle(t,!!n)}function fn(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}let Ue;function Ce(e){Ue=e}function un(){if(!Ue)throw new Error("Function called outside component initialization");return Ue}function cn(){const e=un();return(t,n,{cancelable:o=!1}={})=>{const s=e.$$.callbacks[t];if(s){const r=fn(t,n,{cancelable:o});return s.slice().forEach(i=>{i.call(e,r)}),!r.defaultPrevented}return!0}}function fe(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(o=>o.call(this,t))}const He=[],St=[];let Le=[];const vt=[],hn=Promise.resolve();let nt=!1;function dn(){nt||(nt=!0,hn.then(It))}function ot(e){Le.push(e)}const st=new Set;let Re=0;function It(){if(Re!==0)return;const e=Ue;do{try{for(;Re<He.length;){const t=He[Re];Re++,Ce(t),pn(t.$$)}}catch(t){throw He.length=0,Re=0,t}for(Ce(null),He.length=0,Re=0;St.length;)St.pop()();for(let t=0;t<Le.length;t+=1){const n=Le[t];st.has(n)||(st.add(n),n())}Le.length=0}while(He.length);for(;vt.length;)vt.pop()();nt=!1,st.clear(),Ce(e)}function pn(e){if(e.fragment!==null){e.update(),ae(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ot)}}function mn(e){const t=[],n=[];Le.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),Le=t}const Qe=new Set;let be;function gn(){be={r:0,c:[],p:be}}function yn(){be.r||ae(be.c),be=be.p}function ne(e,t){e&&e.i&&(Qe.delete(e),e.i(t))}function ie(e,t,n,o){if(e&&e.o){if(Qe.has(e))return;Qe.add(e),be.c.push(()=>{Qe.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function kt(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Ee(e){e&&e.c()}function _e(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),ot(()=>{const r=e.$$.on_mount.map(_t).filter(x);e.$$.on_destroy?e.$$.on_destroy.push(...r):ae(r),e.$$.on_mount=[]}),s.forEach(ot)}function we(e,t){const n=e.$$;n.fragment!==null&&(mn(n.after_update),ae(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function _n(e,t){e.$$.dirty[0]===-1&&(He.push(e),dn(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function We(e,t,n,o,s,r,i=null,a=[-1]){const l=Ue;Ce(e);const d=e.$$={fragment:null,ctx:[],props:r,update:Fe,not_equal:s,bound:wt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:wt(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};i&&i(d.root);let p=!1;if(d.ctx=n?n(e,t.props||{},(c,f,...m)=>{const y=m.length?m[0]:f;return d.ctx&&s(d.ctx[c],d.ctx[c]=y)&&(!d.skip_bound&&d.bound[c]&&d.bound[c](y),p&&_n(e,c)),f}):[],d.update(),p=!0,ae(d.before_update),d.fragment=o?o(d.ctx):!1,t.target){if(t.hydrate){const c=an(t.target);d.fragment&&d.fragment.l(c),c.forEach(G)}else d.fragment&&d.fragment.c();t.intro&&ne(e.$$.fragment),_e(e,t.target,t.anchor),It()}Ce(l)}class Je{constructor(){yt(this,"$$"),yt(this,"$$set")}$destroy(){we(this,1),this.$destroy=Fe}$on(t,n){if(!x(n))return Fe;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!tn(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const wn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(wn);var Te=(e=>(e.ELLIPSE="ELLIPSE",e.POLYGON="POLYGON",e.RECTANGLE="RECTANGLE",e))(Te||{});const rt=(e,t)=>t,Tn=e=>{let t=1/0,n=1/0,o=-1/0,s=-1/0;return e.forEach(([r,i])=>{t=Math.min(t,r),n=Math.min(n,i),o=Math.max(o,r),s=Math.max(s,i)}),{minX:t,minY:n,maxX:o,maxY:s}},bn={area:e=>Math.PI*e.geometry.rx*e.geometry.ry,intersects:(e,t,n)=>{const{cx:o,cy:s,rx:r,ry:i}=e.geometry,a=0,l=Math.cos(a),d=Math.sin(a),p=t-o,c=n-s,f=l*p+d*c,m=d*p-l*c;return f*f/(r*r)+m*m/(i*i)<=1}};rt(Te.ELLIPSE,bn);const En={area:e=>{const{points:t}=e.geometry;let n=0,o=t.length-1;for(let s=0;s<t.length;s++)n+=(t[o][0]+t[s][0])*(t[o][1]-t[s][1]),o=s;return Math.abs(.5*n)},intersects:(e,t,n)=>{const{points:o}=e.geometry;let s=!1;for(let r=0,i=o.length-1;r<o.length;i=r++){const a=o[r][0],l=o[r][1],d=o[i][0],p=o[i][1];l>n!=p>n&&t<(d-a)*(n-l)/(p-l)+a&&(s=!s)}return s}};rt(Te.POLYGON,En);const $n={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,n)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&n>=e.geometry.y&&n<=e.geometry.y+e.geometry.h};rt(Te.RECTANGLE,$n);for(var On=[],it=0;it<256;++it)On.push((it+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);for(var Pn=[],lt=0;lt<256;++lt)Pn.push((lt+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Sn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";((e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=Sn[n[e]&63];return t})();function At(e,t,n){const o=e.slice();return o[10]=t[n],o[12]=n,o}function Ht(e){let t,n;return t=new De({props:{x:e[10][0],y:e[10][1],scale:e[3]}}),t.$on("pointerdown",function(){x(e[9](`HANDLE-${e[12]}`))&&e[9](`HANDLE-${e[12]}`).apply(this,arguments)}),{c(){Ee(t.$$.fragment)},m(o,s){_e(t,o,s),n=!0},p(o,s){e=o;const r={};s&16&&(r.x=e[10][0]),s&16&&(r.y=e[10][1]),s&8&&(r.scale=e[3]),t.$set(r)},i(o){n||(ne(t.$$.fragment,o),n=!0)},o(o){ie(t.$$.fragment,o),n=!1},d(o){we(t,o)}}}function vn(e){let t,n,o,s,r,i,a,l,d,p,c,f=kt(e[4].points),m=[];for(let u=0;u<f.length;u+=1)m[u]=Ht(At(e,f,u));const y=u=>ie(m[u],1,1,()=>{m[u]=null});return{c(){t=J("polygon"),s=re(),r=J("polygon"),a=re();for(let u=0;u<m.length;u+=1)m[u].c();l=Ot(),w(t,"class","a9s-outer"),w(t,"style",n=e[1]?"display:none;":void 0),w(t,"points",o=e[4].points.map(Lt).join(" ")),w(r,"class","a9s-inner a9s-shape-handle"),w(r,"style",e[1]),w(r,"points",i=e[4].points.map(Rt).join(" "))},m(u,_){M(u,t,_),M(u,s,_),M(u,r,_),M(u,a,_);for(let T=0;T<m.length;T+=1)m[T]&&m[T].m(u,_);M(u,l,_),d=!0,p||(c=[U(t,"pointerdown",function(){x(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)}),U(r,"pointerdown",function(){x(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)})],p=!0)},p(u,_){if(e=u,(!d||_&2&&n!==(n=e[1]?"display:none;":void 0))&&w(t,"style",n),(!d||_&16&&o!==(o=e[4].points.map(Lt).join(" ")))&&w(t,"points",o),(!d||_&2)&&w(r,"style",e[1]),(!d||_&16&&i!==(i=e[4].points.map(Rt).join(" ")))&&w(r,"points",i),_&536){f=kt(e[4].points);let T;for(T=0;T<f.length;T+=1){const S=At(e,f,T);m[T]?(m[T].p(S,_),ne(m[T],1)):(m[T]=Ht(S),m[T].c(),ne(m[T],1),m[T].m(l.parentNode,l))}for(gn(),T=f.length;T<m.length;T+=1)y(T);yn()}},i(u){if(!d){for(let _=0;_<f.length;_+=1)ne(m[_]);d=!0}},o(u){m=m.filter(Boolean);for(let _=0;_<m.length;_+=1)ie(m[_]);d=!1},d(u){u&&(G(t),G(s),G(r),G(a),G(l)),ln(m,u),p=!1,ae(c)}}}function In(e){let t,n;return t=new Bt({props:{shape:e[0],transform:e[2],editor:e[5],$$slots:{default:[vn,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:e}}}),t.$on("change",e[6]),t.$on("grab",e[7]),t.$on("release",e[8]),{c(){Ee(t.$$.fragment)},m(o,s){_e(t,o,s),n=!0},p(o,[s]){const r={};s&1&&(r.shape=o[0]),s&4&&(r.transform=o[2]),s&8730&&(r.$$scope={dirty:s,ctx:o}),t.$set(r)},i(o){n||(ne(t.$$.fragment,o),n=!0)},o(o){ie(t.$$.fragment,o),n=!1},d(o){we(t,o)}}}const Lt=e=>e.join(","),Rt=e=>e.join(",");function kn(e,t,n){let o,{shape:s}=t,{computedStyle:r}=t,{transform:i}=t,{viewportScale:a=1}=t;const l=(f,m,y)=>{let u;const _=f.geometry;m==="SHAPE"?u=_.points.map(([S,$])=>[S+y[0],$+y[1]]):u=_.points.map(([S,$],I)=>m===`HANDLE-${I}`?[S+y[0],$+y[1]]:[S,$]);const T=Tn(u);return{...f,geometry:{points:u,bounds:T}}};function d(f){fe.call(this,e,f)}function p(f){fe.call(this,e,f)}function c(f){fe.call(this,e,f)}return e.$$set=f=>{"shape"in f&&n(0,s=f.shape),"computedStyle"in f&&n(1,r=f.computedStyle),"transform"in f&&n(2,i=f.transform),"viewportScale"in f&&n(3,a=f.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(4,o=s.geometry)},[s,r,i,a,o,l,d,p,c]}class An extends Je{constructor(t){super(),We(this,t,kn,In,qe,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const Hn=typeof window>"u"||typeof navigator>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function Ln(e){let t,n,o,s,r,i;return{c(){t=J("rect"),w(t,"class",n=xe(`a9s-handle ${e[8].class||""}`.trim())+" svelte-1sgkh33"),w(t,"x",o=e[0]-e[5]/2),w(t,"y",s=e[1]-e[5]/2),w(t,"width",e[5]),w(t,"height",e[5])},m(a,l){M(a,t,l),r||(i=U(t,"pointerdown",e[11]),r=!0)},p(a,l){l&256&&n!==(n=xe(`a9s-handle ${a[8].class||""}`.trim())+" svelte-1sgkh33")&&w(t,"class",n),l&33&&o!==(o=a[0]-a[5]/2)&&w(t,"x",o),l&34&&s!==(s=a[1]-a[5]/2)&&w(t,"y",s),l&32&&w(t,"width",a[5]),l&32&&w(t,"height",a[5])},d(a){a&&G(t),r=!1,i()}}}function Rn(e){let t,n,o,s,r,i,a,l,d;return{c(){t=J("g"),n=J("circle"),s=J("rect"),w(n,"cx",e[0]),w(n,"cy",e[1]),w(n,"r",o=e[3]/e[2]),w(n,"class","a9s-touch-halo svelte-1sgkh33"),Pt(n,"touched",e[4]),w(s,"class",r=xe(`a9s-handle ${e[8].class||""}`.trim())+" svelte-1sgkh33"),w(s,"x",i=e[0]-e[5]/2),w(s,"y",a=e[1]-e[5]/2),w(s,"width",e[5]),w(s,"height",e[5]),w(t,"class","a9s-touch-handle")},m(p,c){M(p,t,c),Et(t,n),Et(t,s),l||(d=[U(n,"pointerdown",e[10]),U(n,"pointerdown",e[6]),U(n,"pointerup",e[7]),U(s,"pointerdown",e[9]),U(s,"pointerdown",e[6]),U(s,"pointerup",e[7])],l=!0)},p(p,c){c&1&&w(n,"cx",p[0]),c&2&&w(n,"cy",p[1]),c&12&&o!==(o=p[3]/p[2])&&w(n,"r",o),c&16&&Pt(n,"touched",p[4]),c&256&&r!==(r=xe(`a9s-handle ${p[8].class||""}`.trim())+" svelte-1sgkh33")&&w(s,"class",r),c&33&&i!==(i=p[0]-p[5]/2)&&w(s,"x",i),c&34&&a!==(a=p[1]-p[5]/2)&&w(s,"y",a),c&32&&w(s,"width",p[5]),c&32&&w(s,"height",p[5])},d(p){p&&G(t),l=!1,ae(d)}}}function Gn(e){let t;function n(s,r){return Hn?Rn:Ln}let o=n()(e);return{c(){o.c(),t=Ot()},m(s,r){o.m(s,r),M(s,t,r)},p(s,[r]){o.p(s,r)},i:Fe,o:Fe,d(s){s&&G(t),o.d(s)}}}function Bn(e,t,n){let o,{x:s}=t,{y:r}=t,{scale:i}=t,{radius:a=30}=t,l=!1;const d=y=>{y.pointerType==="touch"&&n(4,l=!0)},p=()=>n(4,l=!1);function c(y){fe.call(this,e,y)}function f(y){fe.call(this,e,y)}function m(y){fe.call(this,e,y)}return e.$$set=y=>{n(8,t=tt(tt({},t),bt(y))),"x"in y&&n(0,s=y.x),"y"in y&&n(1,r=y.y),"scale"in y&&n(2,i=y.scale),"radius"in y&&n(3,a=y.radius)},e.$$.update=()=>{e.$$.dirty&4&&n(5,o=10/i)},t=bt(t),[s,r,i,a,l,o,d,p,t,c,f,m]}class De extends Je{constructor(t){super(),We(this,t,Bn,Gn,qe,{x:0,y:1,scale:2,radius:3})}}function Nn(e){let t,n,o,s,r,i,a,l,d,p,c,f,m,y,u,_,T,S,$,I,H,R,P,E,v,L,B,j,N,ce,he,de,Pe,D,Se,V,ve,z,Ie,K,O,ke,Ke;return D=new De({props:{class:"a9s-corner-handle-topleft",x:e[4].x,y:e[4].y,scale:e[3]}}),D.$on("pointerdown",function(){x(e[9]("TOP_LEFT"))&&e[9]("TOP_LEFT").apply(this,arguments)}),V=new De({props:{class:"a9s-corner-handle-topright",x:e[4].x+e[4].w,y:e[4].y,scale:e[3]}}),V.$on("pointerdown",function(){x(e[9]("TOP_RIGHT"))&&e[9]("TOP_RIGHT").apply(this,arguments)}),z=new De({props:{class:"a9s-corner-handle-bottomright",x:e[4].x+e[4].w,y:e[4].y+e[4].h,scale:e[3]}}),z.$on("pointerdown",function(){x(e[9]("BOTTOM_RIGHT"))&&e[9]("BOTTOM_RIGHT").apply(this,arguments)}),K=new De({props:{class:"a9s-corner-handle-bottomleft",x:e[4].x,y:e[4].y+e[4].h,scale:e[3]}}),K.$on("pointerdown",function(){x(e[9]("BOTTOM_LEFT"))&&e[9]("BOTTOM_LEFT").apply(this,arguments)}),{c(){t=J("rect"),a=re(),l=J("rect"),m=re(),y=J("rect"),S=re(),$=J("rect"),P=re(),E=J("rect"),j=re(),N=J("rect"),Pe=re(),Ee(D.$$.fragment),Se=re(),Ee(V.$$.fragment),ve=re(),Ee(z.$$.fragment),Ie=re(),Ee(K.$$.fragment),w(t,"class","a9s-outer"),w(t,"style",n=e[1]?"display:none;":void 0),w(t,"x",o=e[4].x),w(t,"y",s=e[4].y),w(t,"width",r=e[4].w),w(t,"height",i=e[4].h),w(l,"class","a9s-inner a9s-shape-handle"),w(l,"style",e[1]),w(l,"x",d=e[4].x),w(l,"y",p=e[4].y),w(l,"width",c=e[4].w),w(l,"height",f=e[4].h),w(y,"class","a9s-edge-handle a9s-edge-handle-top"),w(y,"x",u=e[4].x),w(y,"y",_=e[4].y),w(y,"height",1),w(y,"width",T=e[4].w),w($,"class","a9s-edge-handle a9s-edge-handle-right"),w($,"x",I=e[4].x+e[4].w),w($,"y",H=e[4].y),w($,"height",R=e[4].h),w($,"width",1),w(E,"class","a9s-edge-handle a9s-edge-handle-bottom"),w(E,"x",v=e[4].x),w(E,"y",L=e[4].y+e[4].h),w(E,"height",1),w(E,"width",B=e[4].w),w(N,"class","a9s-edge-handle a9s-edge-handle-left"),w(N,"x",ce=e[4].x),w(N,"y",he=e[4].y),w(N,"height",de=e[4].h),w(N,"width",1)},m(b,g){M(b,t,g),M(b,a,g),M(b,l,g),M(b,m,g),M(b,y,g),M(b,S,g),M(b,$,g),M(b,P,g),M(b,E,g),M(b,j,g),M(b,N,g),M(b,Pe,g),_e(D,b,g),M(b,Se,g),_e(V,b,g),M(b,ve,g),_e(z,b,g),M(b,Ie,g),_e(K,b,g),O=!0,ke||(Ke=[U(t,"pointerdown",function(){x(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)}),U(l,"pointerdown",function(){x(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)}),U(y,"pointerdown",function(){x(e[9]("TOP"))&&e[9]("TOP").apply(this,arguments)}),U($,"pointerdown",function(){x(e[9]("RIGHT"))&&e[9]("RIGHT").apply(this,arguments)}),U(E,"pointerdown",function(){x(e[9]("BOTTOM"))&&e[9]("BOTTOM").apply(this,arguments)}),U(N,"pointerdown",function(){x(e[9]("LEFT"))&&e[9]("LEFT").apply(this,arguments)})],ke=!0)},p(b,g){e=b,(!O||g&2&&n!==(n=e[1]?"display:none;":void 0))&&w(t,"style",n),(!O||g&16&&o!==(o=e[4].x))&&w(t,"x",o),(!O||g&16&&s!==(s=e[4].y))&&w(t,"y",s),(!O||g&16&&r!==(r=e[4].w))&&w(t,"width",r),(!O||g&16&&i!==(i=e[4].h))&&w(t,"height",i),(!O||g&2)&&w(l,"style",e[1]),(!O||g&16&&d!==(d=e[4].x))&&w(l,"x",d),(!O||g&16&&p!==(p=e[4].y))&&w(l,"y",p),(!O||g&16&&c!==(c=e[4].w))&&w(l,"width",c),(!O||g&16&&f!==(f=e[4].h))&&w(l,"height",f),(!O||g&16&&u!==(u=e[4].x))&&w(y,"x",u),(!O||g&16&&_!==(_=e[4].y))&&w(y,"y",_),(!O||g&16&&T!==(T=e[4].w))&&w(y,"width",T),(!O||g&16&&I!==(I=e[4].x+e[4].w))&&w($,"x",I),(!O||g&16&&H!==(H=e[4].y))&&w($,"y",H),(!O||g&16&&R!==(R=e[4].h))&&w($,"height",R),(!O||g&16&&v!==(v=e[4].x))&&w(E,"x",v),(!O||g&16&&L!==(L=e[4].y+e[4].h))&&w(E,"y",L),(!O||g&16&&B!==(B=e[4].w))&&w(E,"width",B),(!O||g&16&&ce!==(ce=e[4].x))&&w(N,"x",ce),(!O||g&16&&he!==(he=e[4].y))&&w(N,"y",he),(!O||g&16&&de!==(de=e[4].h))&&w(N,"height",de);const pe={};g&16&&(pe.x=e[4].x),g&16&&(pe.y=e[4].y),g&8&&(pe.scale=e[3]),D.$set(pe);const me={};g&16&&(me.x=e[4].x+e[4].w),g&16&&(me.y=e[4].y),g&8&&(me.scale=e[3]),V.$set(me);const ge={};g&16&&(ge.x=e[4].x+e[4].w),g&16&&(ge.y=e[4].y+e[4].h),g&8&&(ge.scale=e[3]),z.$set(ge);const ye={};g&16&&(ye.x=e[4].x),g&16&&(ye.y=e[4].y+e[4].h),g&8&&(ye.scale=e[3]),K.$set(ye)},i(b){O||(ne(D.$$.fragment,b),ne(V.$$.fragment,b),ne(z.$$.fragment,b),ne(K.$$.fragment,b),O=!0)},o(b){ie(D.$$.fragment,b),ie(V.$$.fragment,b),ie(z.$$.fragment,b),ie(K.$$.fragment,b),O=!1},d(b){b&&(G(t),G(a),G(l),G(m),G(y),G(S),G($),G(P),G(E),G(j),G(N),G(Pe),G(Se),G(ve),G(Ie)),we(D,b),we(V,b),we(z,b),we(K,b),ke=!1,ae(Ke)}}}function Mn(e){let t,n;return t=new Bt({props:{shape:e[0],transform:e[2],editor:e[5],$$slots:{default:[Nn,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:e}}}),t.$on("grab",e[6]),t.$on("change",e[7]),t.$on("release",e[8]),{c(){Ee(t.$$.fragment)},m(o,s){_e(t,o,s),n=!0},p(o,[s]){const r={};s&1&&(r.shape=o[0]),s&4&&(r.transform=o[2]),s&1562&&(r.$$scope={dirty:s,ctx:o}),t.$set(r)},i(o){n||(ne(t.$$.fragment,o),n=!0)},o(o){ie(t.$$.fragment,o),n=!1},d(o){we(t,o)}}}function Yn(e,t,n){let o,{shape:s}=t,{computedStyle:r}=t,{transform:i}=t,{viewportScale:a=1}=t;const l=(f,m,y)=>{const u=f.geometry.bounds;let[_,T]=[u.minX,u.minY],[S,$]=[u.maxX,u.maxY];const[I,H]=y;if(m==="SHAPE")_+=I,S+=I,T+=H,$+=H;else{switch(m){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{T+=H;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{$+=H;break}}switch(m){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{_+=I;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{S+=I;break}}}const R=Math.min(_,S),P=Math.min(T,$),E=Math.abs(S-_),v=Math.abs($-T);return{...f,geometry:{x:R,y:P,w:E,h:v,bounds:{minX:R,minY:P,maxX:R+E,maxY:P+v}}}};function d(f){fe.call(this,e,f)}function p(f){fe.call(this,e,f)}function c(f){fe.call(this,e,f)}return e.$$set=f=>{"shape"in f&&n(0,s=f.shape),"computedStyle"in f&&n(1,r=f.computedStyle),"transform"in f&&n(2,i=f.transform),"viewportScale"in f&&n(3,a=f.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(4,o=s.geometry)},[s,r,i,a,o,l,d,p,c]}class jn extends Je{constructor(t){super(),We(this,t,Yn,Mn,qe,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}Te.RECTANGLE,Te.POLYGON;const Xn=e=>({}),Gt=e=>({grab:e[0]});function Fn(e){let t,n,o,s;const r=e[7].default,i=nn(r,e,e[6],Gt);return{c(){t=J("g"),i&&i.c(),w(t,"class","a9s-annotation selected")},m(a,l){M(a,t,l),i&&i.m(t,null),n=!0,o||(s=[U(t,"pointerup",e[2]),U(t,"pointermove",e[1])],o=!0)},p(a,[l]){i&&i.p&&(!n||l&64)&&sn(i,r,a,a[6],n?on(r,a[6],l,Xn):rn(a[6]),Gt)},i(a){n||(ne(i,a),n=!0)},o(a){ie(i,a),n=!1},d(a){a&&G(t),i&&i.d(a),o=!1,ae(s)}}}function Un(e,t,n){let{$$slots:o={},$$scope:s}=t;const r=cn();let{shape:i}=t,{editor:a}=t,{transform:l}=t,d,p,c;const f=u=>_=>{d=u,p=l.elementToImage(_.offsetX,_.offsetY),c=i,_.target.setPointerCapture(_.pointerId),r("grab",_)},m=u=>{if(d){const[_,T]=l.elementToImage(u.offsetX,u.offsetY),S=[_-p[0],T-p[1]];n(3,i=a(c,d,S)),r("change",i)}},y=u=>{u.target.releasePointerCapture(u.pointerId),d=void 0,c=i,r("release",u)};return e.$$set=u=>{"shape"in u&&n(3,i=u.shape),"editor"in u&&n(4,a=u.editor),"transform"in u&&n(5,l=u.transform),"$$scope"in u&&n(6,s=u.$$scope)},[f,m,y,i,a,l,s,o]}class Bt extends Je{constructor(t){super(),We(this,t,Un,Fn,qe,{shape:3,editor:4,transform:5})}}typeof navigator>"u"||navigator.userAgent.indexOf("Mac OS X");function $e(){}function at(e,t){for(const n in t)e[n]=t[n];return e}function Nt(e){return e()}function Mt(){return Object.create(null)}function le(e){e.forEach(Nt)}function Y(e){return typeof e=="function"}function Ge(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Cn(e){return Object.keys(e).length===0}function Dn(e,t,n,o){if(e){const s=Yt(e,t,n,o);return e[0](s)}}function Yt(e,t,n,o){return e[1]&&o?at(n.ctx.slice(),e[1](o(t))):n.ctx}function Vn(e,t,n,o){if(e[2]&&o){const s=e[2](o(n));if(t.dirty===void 0)return s;if(typeof s=="object"){const r=[],i=Math.max(t.dirty.length,s.length);for(let a=0;a<i;a+=1)r[a]=t.dirty[a]|s[a];return r}return t.dirty|s}return t.dirty}function zn(e,t,n,o,s,r){if(s){const i=Yt(t,n,o,r);e.p(i,s)}}function Kn(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let o=0;o<n;o++)t[o]=-1;return t}return-1}function jt(e){const t={};for(const n in e)n[0]!=="$"&&(t[n]=e[n]);return t}function Ze(e){return e??""}function Xt(e,t){e.appendChild(t)}function A(e,t,n){e.insertBefore(t,n||null)}function k(e){e.parentNode&&e.parentNode.removeChild(e)}function qn(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function F(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Ft(e){return document.createTextNode(e)}function q(){return Ft(" ")}function Ut(){return Ft("")}function X(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function h(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function xn(e){return Array.from(e.childNodes)}function Ct(e,t,n){e.classList.toggle(t,!!n)}function Qn(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}let Ve;function ze(e){Ve=e}function Dt(){if(!Ve)throw new Error("Function called outside component initialization");return Ve}function Wn(e){Dt().$$.on_mount.push(e)}function Vt(){const e=Dt();return(t,n,{cancelable:o=!1}={})=>{const s=e.$$.callbacks[t];if(s){const r=Qn(t,n,{cancelable:o});return s.slice().forEach(i=>{i.call(e,r)}),!r.defaultPrevented}return!0}}function oe(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(o=>o.call(this,t))}const Be=[],ft=[];let Ne=[];const zt=[],Jn=Promise.resolve();let ut=!1;function Zn(){ut||(ut=!0,Jn.then(Kt))}function ct(e){Ne.push(e)}const ht=new Set;let Me=0;function Kt(){if(Me!==0)return;const e=Ve;do{try{for(;Me<Be.length;){const t=Be[Me];Me++,ze(t),eo(t.$$)}}catch(t){throw Be.length=0,Me=0,t}for(ze(null),Be.length=0,Me=0;ft.length;)ft.pop()();for(let t=0;t<Ne.length;t+=1){const n=Ne[t];ht.has(n)||(ht.add(n),n())}Ne.length=0}while(Be.length);for(;zt.length;)zt.pop()();ut=!1,ht.clear(),ze(e)}function eo(e){if(e.fragment!==null){e.update(),le(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ct)}}function to(e){const t=[],n=[];Ne.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),Ne=t}const et=new Set;let Oe;function no(){Oe={r:0,c:[],p:Oe}}function oo(){Oe.r||le(Oe.c),Oe=Oe.p}function C(e,t){e&&e.i&&(et.delete(e),e.i(t))}function Q(e,t,n,o){if(e&&e.o){if(et.has(e))return;et.add(e),Oe.c.push(()=>{et.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function qt(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function se(e){e&&e.c()}function Z(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),ct(()=>{const r=e.$$.on_mount.map(Nt).filter(Y);e.$$.on_destroy?e.$$.on_destroy.push(...r):le(r),e.$$.on_mount=[]}),s.forEach(ct)}function ee(e,t){const n=e.$$;n.fragment!==null&&(to(n.after_update),le(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function so(e,t){e.$$.dirty[0]===-1&&(Be.push(e),Zn(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ye(e,t,n,o,s,r,i=null,a=[-1]){const l=Ve;ze(e);const d=e.$$={fragment:null,ctx:[],props:r,update:$e,not_equal:s,bound:Mt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Mt(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};i&&i(d.root);let p=!1;if(d.ctx=n?n(e,t.props||{},(c,f,...m)=>{const y=m.length?m[0]:f;return d.ctx&&s(d.ctx[c],d.ctx[c]=y)&&(!d.skip_bound&&d.bound[c]&&d.bound[c](y),p&&so(e,c)),f}):[],d.update(),p=!0,le(d.before_update),d.fragment=o?o(d.ctx):!1,t.target){if(t.hydrate){const c=xn(t.target);d.fragment&&d.fragment.l(c),c.forEach(k)}else d.fragment&&d.fragment.c();t.intro&&C(e.$$.fragment),Z(e,t.target,t.anchor),Kt()}ze(l)}class je{constructor(){gt(this,"$$");gt(this,"$$set")}$destroy(){ee(this,1),this.$destroy=$e}$on(t,n){if(!Y(n))return $e;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!Cn(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const ro="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ro);var Xe=(e=>(e.ELLIPSE="ELLIPSE",e.POLYGON="POLYGON",e.RECTANGLE="RECTANGLE",e))(Xe||{});const dt=(e,t)=>t,io=e=>{let t=1/0,n=1/0,o=-1/0,s=-1/0;return e.forEach(([r,i])=>{t=Math.min(t,r),n=Math.min(n,i),o=Math.max(o,r),s=Math.max(s,i)}),{minX:t,minY:n,maxX:o,maxY:s}},lo={area:e=>Math.PI*e.geometry.rx*e.geometry.ry,intersects:(e,t,n)=>{const{cx:o,cy:s,rx:r,ry:i}=e.geometry,a=0,l=Math.cos(a),d=Math.sin(a),p=t-o,c=n-s,f=l*p+d*c,m=d*p-l*c;return f*f/(r*r)+m*m/(i*i)<=1}};dt(Xe.ELLIPSE,lo);const ao={area:e=>{const{points:t}=e.geometry;let n=0,o=t.length-1;for(let s=0;s<t.length;s++)n+=(t[o][0]+t[s][0])*(t[o][1]-t[s][1]),o=s;return Math.abs(.5*n)},intersects:(e,t,n)=>{const{points:o}=e.geometry;let s=!1;for(let r=0,i=o.length-1;r<o.length;i=r++){const a=o[r][0],l=o[r][1],d=o[i][0],p=o[i][1];l>n!=p>n&&t<(d-a)*(n-l)/(p-l)+a&&(s=!s)}return s}};dt(Xe.POLYGON,ao);const fo={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,n)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&n>=e.geometry.y&&n<=e.geometry.y+e.geometry.h};dt(Xe.RECTANGLE,fo);for(var uo=[],pt=0;pt<256;++pt)uo.push((pt+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const co="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";((e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=co[n[e]&63];return t})();function xt(e,t,n){const o=e.slice();return o[10]=t[n],o[12]=n,o}function Qt(e){let t,n;return t=new ue({props:{x:e[10][0],y:e[10][1],scale:e[3]}}),t.$on("pointerdown",function(){Y(e[9](`HANDLE-${e[12]}`))&&e[9](`HANDLE-${e[12]}`).apply(this,arguments)}),{c(){se(t.$$.fragment)},m(o,s){Z(t,o,s),n=!0},p(o,s){e=o;const r={};s&16&&(r.x=e[10][0]),s&16&&(r.y=e[10][1]),s&8&&(r.scale=e[3]),t.$set(r)},i(o){n||(C(t.$$.fragment,o),n=!0)},o(o){Q(t.$$.fragment,o),n=!1},d(o){ee(t,o)}}}function ho(e){let t,n,o,s,r,i,a,l,d,p,c,f=qt(e[4].points),m=[];for(let u=0;u<f.length;u+=1)m[u]=Qt(xt(e,f,u));const y=u=>Q(m[u],1,1,()=>{m[u]=null});return{c(){t=F("polygon"),s=q(),r=F("polygon"),a=q();for(let u=0;u<m.length;u+=1)m[u].c();l=Ut(),h(t,"class","a9s-outer"),h(t,"style",n=e[1]?"display:none;":void 0),h(t,"points",o=e[4].points.map(Wt).join(" ")),h(r,"class","a9s-inner a9s-shape-handle"),h(r,"style",e[1]),h(r,"points",i=e[4].points.map(Jt).join(" "))},m(u,_){A(u,t,_),A(u,s,_),A(u,r,_),A(u,a,_);for(let T=0;T<m.length;T+=1)m[T]&&m[T].m(u,_);A(u,l,_),d=!0,p||(c=[X(t,"pointerdown",function(){Y(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)}),X(r,"pointerdown",function(){Y(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)})],p=!0)},p(u,_){if(e=u,(!d||_&2&&n!==(n=e[1]?"display:none;":void 0))&&h(t,"style",n),(!d||_&16&&o!==(o=e[4].points.map(Wt).join(" ")))&&h(t,"points",o),(!d||_&2)&&h(r,"style",e[1]),(!d||_&16&&i!==(i=e[4].points.map(Jt).join(" ")))&&h(r,"points",i),_&536){f=qt(e[4].points);let T;for(T=0;T<f.length;T+=1){const S=xt(e,f,T);m[T]?(m[T].p(S,_),C(m[T],1)):(m[T]=Qt(S),m[T].c(),C(m[T],1),m[T].m(l.parentNode,l))}for(no(),T=f.length;T<m.length;T+=1)y(T);oo()}},i(u){if(!d){for(let _=0;_<f.length;_+=1)C(m[_]);d=!0}},o(u){m=m.filter(Boolean);for(let _=0;_<m.length;_+=1)Q(m[_]);d=!1},d(u){u&&(k(t),k(s),k(r),k(a),k(l)),qn(m,u),p=!1,le(c)}}}function po(e){let t,n;return t=new mt({props:{shape:e[0],transform:e[2],editor:e[5],$$slots:{default:[ho,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:e}}}),t.$on("change",e[6]),t.$on("grab",e[7]),t.$on("release",e[8]),{c(){se(t.$$.fragment)},m(o,s){Z(t,o,s),n=!0},p(o,[s]){const r={};s&1&&(r.shape=o[0]),s&4&&(r.transform=o[2]),s&8730&&(r.$$scope={dirty:s,ctx:o}),t.$set(r)},i(o){n||(C(t.$$.fragment,o),n=!0)},o(o){Q(t.$$.fragment,o),n=!1},d(o){ee(t,o)}}}const Wt=e=>e.join(","),Jt=e=>e.join(",");function mo(e,t,n){let o,{shape:s}=t,{computedStyle:r}=t,{transform:i}=t,{viewportScale:a=1}=t;const l=(f,m,y)=>{let u;const _=f.geometry;m==="SHAPE"?u=_.points.map(([S,$])=>[S+y[0],$+y[1]]):u=_.points.map(([S,$],I)=>m===`HANDLE-${I}`?[S+y[0],$+y[1]]:[S,$]);const T=io(u);return{...f,geometry:{points:u,bounds:T}}};function d(f){oe.call(this,e,f)}function p(f){oe.call(this,e,f)}function c(f){oe.call(this,e,f)}return e.$$set=f=>{"shape"in f&&n(0,s=f.shape),"computedStyle"in f&&n(1,r=f.computedStyle),"transform"in f&&n(2,i=f.transform),"viewportScale"in f&&n(3,a=f.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(4,o=s.geometry)},[s,r,i,a,o,l,d,p,c]}class go extends je{constructor(t){super(),Ye(this,t,mo,po,Ge,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}const yo=typeof window>"u"||typeof navigator>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function _o(e){let t,n,o,s,r,i;return{c(){t=F("rect"),h(t,"class",n=Ze(`a9s-handle ${e[8].class||""}`.trim())+" svelte-1sgkh33"),h(t,"x",o=e[0]-e[5]/2),h(t,"y",s=e[1]-e[5]/2),h(t,"width",e[5]),h(t,"height",e[5])},m(a,l){A(a,t,l),r||(i=X(t,"pointerdown",e[11]),r=!0)},p(a,l){l&256&&n!==(n=Ze(`a9s-handle ${a[8].class||""}`.trim())+" svelte-1sgkh33")&&h(t,"class",n),l&33&&o!==(o=a[0]-a[5]/2)&&h(t,"x",o),l&34&&s!==(s=a[1]-a[5]/2)&&h(t,"y",s),l&32&&h(t,"width",a[5]),l&32&&h(t,"height",a[5])},d(a){a&&k(t),r=!1,i()}}}function wo(e){let t,n,o,s,r,i,a,l,d;return{c(){t=F("g"),n=F("circle"),s=F("rect"),h(n,"cx",e[0]),h(n,"cy",e[1]),h(n,"r",o=e[3]/e[2]),h(n,"class","a9s-touch-halo svelte-1sgkh33"),Ct(n,"touched",e[4]),h(s,"class",r=Ze(`a9s-handle ${e[8].class||""}`.trim())+" svelte-1sgkh33"),h(s,"x",i=e[0]-e[5]/2),h(s,"y",a=e[1]-e[5]/2),h(s,"width",e[5]),h(s,"height",e[5]),h(t,"class","a9s-touch-handle")},m(p,c){A(p,t,c),Xt(t,n),Xt(t,s),l||(d=[X(n,"pointerdown",e[10]),X(n,"pointerdown",e[6]),X(n,"pointerup",e[7]),X(s,"pointerdown",e[9]),X(s,"pointerdown",e[6]),X(s,"pointerup",e[7])],l=!0)},p(p,c){c&1&&h(n,"cx",p[0]),c&2&&h(n,"cy",p[1]),c&12&&o!==(o=p[3]/p[2])&&h(n,"r",o),c&16&&Ct(n,"touched",p[4]),c&256&&r!==(r=Ze(`a9s-handle ${p[8].class||""}`.trim())+" svelte-1sgkh33")&&h(s,"class",r),c&33&&i!==(i=p[0]-p[5]/2)&&h(s,"x",i),c&34&&a!==(a=p[1]-p[5]/2)&&h(s,"y",a),c&32&&h(s,"width",p[5]),c&32&&h(s,"height",p[5])},d(p){p&&k(t),l=!1,le(d)}}}function To(e){let t;function n(r,i){return yo?wo:_o}let s=n()(e);return{c(){s.c(),t=Ut()},m(r,i){s.m(r,i),A(r,t,i)},p(r,[i]){s.p(r,i)},i:$e,o:$e,d(r){r&&k(t),s.d(r)}}}function bo(e,t,n){let o,{x:s}=t,{y:r}=t,{scale:i}=t,{radius:a=30}=t,l=!1;const d=y=>{y.pointerType==="touch"&&n(4,l=!0)},p=()=>n(4,l=!1);function c(y){oe.call(this,e,y)}function f(y){oe.call(this,e,y)}function m(y){oe.call(this,e,y)}return e.$$set=y=>{n(8,t=at(at({},t),jt(y))),"x"in y&&n(0,s=y.x),"y"in y&&n(1,r=y.y),"scale"in y&&n(2,i=y.scale),"radius"in y&&n(3,a=y.radius)},e.$$.update=()=>{e.$$.dirty&4&&n(5,o=10/i)},t=jt(t),[s,r,i,a,l,o,d,p,t,c,f,m]}class ue extends je{constructor(t){super(),Ye(this,t,bo,To,Ge,{x:0,y:1,scale:2,radius:3})}}function Eo(e){let t,n,o,s,r,i,a,l,d,p,c,f,m,y,u,_,T,S,$,I,H,R,P,E,v,L,B,j,N,ce,he,de,Pe,D,Se,V,ve,z,Ie,K,O,ke,Ke;return D=new ue({props:{class:"a9s-corner-handle-topleft",x:e[4].x,y:e[4].y,scale:e[3]}}),D.$on("pointerdown",function(){Y(e[9]("TOP_LEFT"))&&e[9]("TOP_LEFT").apply(this,arguments)}),V=new ue({props:{class:"a9s-corner-handle-topright",x:e[4].x+e[4].w,y:e[4].y,scale:e[3]}}),V.$on("pointerdown",function(){Y(e[9]("TOP_RIGHT"))&&e[9]("TOP_RIGHT").apply(this,arguments)}),z=new ue({props:{class:"a9s-corner-handle-bottomright",x:e[4].x+e[4].w,y:e[4].y+e[4].h,scale:e[3]}}),z.$on("pointerdown",function(){Y(e[9]("BOTTOM_RIGHT"))&&e[9]("BOTTOM_RIGHT").apply(this,arguments)}),K=new ue({props:{class:"a9s-corner-handle-bottomleft",x:e[4].x,y:e[4].y+e[4].h,scale:e[3]}}),K.$on("pointerdown",function(){Y(e[9]("BOTTOM_LEFT"))&&e[9]("BOTTOM_LEFT").apply(this,arguments)}),{c(){t=F("rect"),a=q(),l=F("rect"),m=q(),y=F("rect"),S=q(),$=F("rect"),P=q(),E=F("rect"),j=q(),N=F("rect"),Pe=q(),se(D.$$.fragment),Se=q(),se(V.$$.fragment),ve=q(),se(z.$$.fragment),Ie=q(),se(K.$$.fragment),h(t,"class","a9s-outer"),h(t,"style",n=e[1]?"display:none;":void 0),h(t,"x",o=e[4].x),h(t,"y",s=e[4].y),h(t,"width",r=e[4].w),h(t,"height",i=e[4].h),h(l,"class","a9s-inner a9s-shape-handle"),h(l,"style",e[1]),h(l,"x",d=e[4].x),h(l,"y",p=e[4].y),h(l,"width",c=e[4].w),h(l,"height",f=e[4].h),h(y,"class","a9s-edge-handle a9s-edge-handle-top"),h(y,"x",u=e[4].x),h(y,"y",_=e[4].y),h(y,"height",1),h(y,"width",T=e[4].w),h($,"class","a9s-edge-handle a9s-edge-handle-right"),h($,"x",I=e[4].x+e[4].w),h($,"y",H=e[4].y),h($,"height",R=e[4].h),h($,"width",1),h(E,"class","a9s-edge-handle a9s-edge-handle-bottom"),h(E,"x",v=e[4].x),h(E,"y",L=e[4].y+e[4].h),h(E,"height",1),h(E,"width",B=e[4].w),h(N,"class","a9s-edge-handle a9s-edge-handle-left"),h(N,"x",ce=e[4].x),h(N,"y",he=e[4].y),h(N,"height",de=e[4].h),h(N,"width",1)},m(b,g){A(b,t,g),A(b,a,g),A(b,l,g),A(b,m,g),A(b,y,g),A(b,S,g),A(b,$,g),A(b,P,g),A(b,E,g),A(b,j,g),A(b,N,g),A(b,Pe,g),Z(D,b,g),A(b,Se,g),Z(V,b,g),A(b,ve,g),Z(z,b,g),A(b,Ie,g),Z(K,b,g),O=!0,ke||(Ke=[X(t,"pointerdown",function(){Y(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)}),X(l,"pointerdown",function(){Y(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)}),X(y,"pointerdown",function(){Y(e[9]("TOP"))&&e[9]("TOP").apply(this,arguments)}),X($,"pointerdown",function(){Y(e[9]("RIGHT"))&&e[9]("RIGHT").apply(this,arguments)}),X(E,"pointerdown",function(){Y(e[9]("BOTTOM"))&&e[9]("BOTTOM").apply(this,arguments)}),X(N,"pointerdown",function(){Y(e[9]("LEFT"))&&e[9]("LEFT").apply(this,arguments)})],ke=!0)},p(b,g){e=b,(!O||g&2&&n!==(n=e[1]?"display:none;":void 0))&&h(t,"style",n),(!O||g&16&&o!==(o=e[4].x))&&h(t,"x",o),(!O||g&16&&s!==(s=e[4].y))&&h(t,"y",s),(!O||g&16&&r!==(r=e[4].w))&&h(t,"width",r),(!O||g&16&&i!==(i=e[4].h))&&h(t,"height",i),(!O||g&2)&&h(l,"style",e[1]),(!O||g&16&&d!==(d=e[4].x))&&h(l,"x",d),(!O||g&16&&p!==(p=e[4].y))&&h(l,"y",p),(!O||g&16&&c!==(c=e[4].w))&&h(l,"width",c),(!O||g&16&&f!==(f=e[4].h))&&h(l,"height",f),(!O||g&16&&u!==(u=e[4].x))&&h(y,"x",u),(!O||g&16&&_!==(_=e[4].y))&&h(y,"y",_),(!O||g&16&&T!==(T=e[4].w))&&h(y,"width",T),(!O||g&16&&I!==(I=e[4].x+e[4].w))&&h($,"x",I),(!O||g&16&&H!==(H=e[4].y))&&h($,"y",H),(!O||g&16&&R!==(R=e[4].h))&&h($,"height",R),(!O||g&16&&v!==(v=e[4].x))&&h(E,"x",v),(!O||g&16&&L!==(L=e[4].y+e[4].h))&&h(E,"y",L),(!O||g&16&&B!==(B=e[4].w))&&h(E,"width",B),(!O||g&16&&ce!==(ce=e[4].x))&&h(N,"x",ce),(!O||g&16&&he!==(he=e[4].y))&&h(N,"y",he),(!O||g&16&&de!==(de=e[4].h))&&h(N,"height",de);const pe={};g&16&&(pe.x=e[4].x),g&16&&(pe.y=e[4].y),g&8&&(pe.scale=e[3]),D.$set(pe);const me={};g&16&&(me.x=e[4].x+e[4].w),g&16&&(me.y=e[4].y),g&8&&(me.scale=e[3]),V.$set(me);const ge={};g&16&&(ge.x=e[4].x+e[4].w),g&16&&(ge.y=e[4].y+e[4].h),g&8&&(ge.scale=e[3]),z.$set(ge);const ye={};g&16&&(ye.x=e[4].x),g&16&&(ye.y=e[4].y+e[4].h),g&8&&(ye.scale=e[3]),K.$set(ye)},i(b){O||(C(D.$$.fragment,b),C(V.$$.fragment,b),C(z.$$.fragment,b),C(K.$$.fragment,b),O=!0)},o(b){Q(D.$$.fragment,b),Q(V.$$.fragment,b),Q(z.$$.fragment,b),Q(K.$$.fragment,b),O=!1},d(b){b&&(k(t),k(a),k(l),k(m),k(y),k(S),k($),k(P),k(E),k(j),k(N),k(Pe),k(Se),k(ve),k(Ie)),ee(D,b),ee(V,b),ee(z,b),ee(K,b),ke=!1,le(Ke)}}}function $o(e){let t,n;return t=new mt({props:{shape:e[0],transform:e[2],editor:e[5],$$slots:{default:[Eo,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:e}}}),t.$on("grab",e[6]),t.$on("change",e[7]),t.$on("release",e[8]),{c(){se(t.$$.fragment)},m(o,s){Z(t,o,s),n=!0},p(o,[s]){const r={};s&1&&(r.shape=o[0]),s&4&&(r.transform=o[2]),s&1562&&(r.$$scope={dirty:s,ctx:o}),t.$set(r)},i(o){n||(C(t.$$.fragment,o),n=!0)},o(o){Q(t.$$.fragment,o),n=!1},d(o){ee(t,o)}}}function Oo(e,t,n){let o,{shape:s}=t,{computedStyle:r}=t,{transform:i}=t,{viewportScale:a=1}=t;const l=(f,m,y)=>{const u=f.geometry.bounds;let[_,T]=[u.minX,u.minY],[S,$]=[u.maxX,u.maxY];const[I,H]=y;if(m==="SHAPE")_+=I,S+=I,T+=H,$+=H;else{switch(m){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{T+=H;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{$+=H;break}}switch(m){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{_+=I;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{S+=I;break}}}const R=Math.min(_,S),P=Math.min(T,$),E=Math.abs(S-_),v=Math.abs($-T);return{...f,geometry:{x:R,y:P,w:E,h:v,bounds:{minX:R,minY:P,maxX:R+E,maxY:P+v}}}};function d(f){oe.call(this,e,f)}function p(f){oe.call(this,e,f)}function c(f){oe.call(this,e,f)}return e.$$set=f=>{"shape"in f&&n(0,s=f.shape),"computedStyle"in f&&n(1,r=f.computedStyle),"transform"in f&&n(2,i=f.transform),"viewportScale"in f&&n(3,a=f.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(4,o=s.geometry)},[s,r,i,a,o,l,d,p,c]}class Po extends je{constructor(t){super(),Ye(this,t,Oo,$o,Ge,{shape:0,computedStyle:1,transform:2,viewportScale:3})}}Xe.RECTANGLE,Xe.POLYGON;const So=e=>({}),Zt=e=>({grab:e[0]});function vo(e){let t,n,o,s;const r=e[7].default,i=Dn(r,e,e[6],Zt);return{c(){t=F("g"),i&&i.c(),h(t,"class","a9s-annotation selected")},m(a,l){A(a,t,l),i&&i.m(t,null),n=!0,o||(s=[X(t,"pointerup",e[2]),X(t,"pointermove",e[1])],o=!0)},p(a,[l]){i&&i.p&&(!n||l&64)&&zn(i,r,a,a[6],n?Vn(r,a[6],l,So):Kn(a[6]),Zt)},i(a){n||(C(i,a),n=!0)},o(a){Q(i,a),n=!1},d(a){a&&k(t),i&&i.d(a),o=!1,le(s)}}}function Io(e,t,n){let{$$slots:o={},$$scope:s}=t;const r=Vt();let{shape:i}=t,{editor:a}=t,{transform:l}=t,d,p,c;const f=u=>_=>{d=u,p=l.elementToImage(_.offsetX,_.offsetY),c=i,_.target.setPointerCapture(_.pointerId),r("grab",_)},m=u=>{if(d){const[_,T]=l.elementToImage(u.offsetX,u.offsetY),S=[_-p[0],T-p[1]];n(3,i=a(c,d,S)),r("change",i)}},y=u=>{u.target.releasePointerCapture(u.pointerId),d=void 0,c=i,r("release",u)};return e.$$set=u=>{"shape"in u&&n(3,i=u.shape),"editor"in u&&n(4,a=u.editor),"transform"in u&&n(5,l=u.transform),"$$scope"in u&&n(6,s=u.$$scope)},[f,m,y,i,a,l,s,o]}class mt extends je{constructor(t){super(),Ye(this,t,Io,vo,Ge,{shape:3,editor:4,transform:5})}}typeof navigator>"u"?!1:navigator.userAgent.indexOf("Mac OS X")!==-1;function ko(e){let t,n,o,s,r,i,a,l,d,p,c,f,m,y,u,_,T,S,$,I,H,R;return m=new ue({props:{class:"a9s-corner-top",x:e[3].cx,y:e[3].cy-e[3].ry,scale:e[2]}}),m.$on("pointerdown",function(){Y(e[9]("TOP"))&&e[9]("TOP").apply(this,arguments)}),u=new ue({props:{class:"a9s-corner-handle-right",x:e[3].cx+e[3].rx,y:e[3].cy,scale:e[2]}}),u.$on("pointerdown",function(){Y(e[9]("RIGHT"))&&e[9]("RIGHT").apply(this,arguments)}),T=new ue({props:{class:"a9s-corner-handle-bottom",x:e[3].cx,y:e[3].cy+e[3].ry,scale:e[2]}}),T.$on("pointerdown",function(){Y(e[9]("BOTTOM"))&&e[9]("BOTTOM").apply(this,arguments)}),$=new ue({props:{class:"a9s-corner-handle-left",x:e[3].cx-e[3].rx,y:e[3].cy,scale:e[2]}}),$.$on("pointerdown",function(){Y(e[9]("LEFT"))&&e[9]("LEFT").apply(this,arguments)}),{c(){t=F("ellipse"),i=q(),a=F("ellipse"),f=q(),se(m.$$.fragment),y=q(),se(u.$$.fragment),_=q(),se(T.$$.fragment),S=q(),se($.$$.fragment),h(t,"class","a9s-outer"),h(t,"cx",n=e[3].cx),h(t,"cy",o=e[3].cy),h(t,"rx",s=e[3].rx),h(t,"ry",r=e[3].ry),h(a,"class","a9s-inner a9s-shape-handle"),h(a,"cx",l=e[3].cx),h(a,"cy",d=e[3].cy),h(a,"rx",p=e[3].rx),h(a,"ry",c=e[3].ry)},m(P,E){A(P,t,E),A(P,i,E),A(P,a,E),A(P,f,E),Z(m,P,E),A(P,y,E),Z(u,P,E),A(P,_,E),Z(T,P,E),A(P,S,E),Z($,P,E),I=!0,H||(R=[X(t,"pointerdown",function(){Y(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)}),X(a,"pointerdown",function(){Y(e[9]("SHAPE"))&&e[9]("SHAPE").apply(this,arguments)})],H=!0)},p(P,E){e=P,(!I||E&8&&n!==(n=e[3].cx))&&h(t,"cx",n),(!I||E&8&&o!==(o=e[3].cy))&&h(t,"cy",o),(!I||E&8&&s!==(s=e[3].rx))&&h(t,"rx",s),(!I||E&8&&r!==(r=e[3].ry))&&h(t,"ry",r),(!I||E&8&&l!==(l=e[3].cx))&&h(a,"cx",l),(!I||E&8&&d!==(d=e[3].cy))&&h(a,"cy",d),(!I||E&8&&p!==(p=e[3].rx))&&h(a,"rx",p),(!I||E&8&&c!==(c=e[3].ry))&&h(a,"ry",c);const v={};E&8&&(v.x=e[3].cx),E&8&&(v.y=e[3].cy-e[3].ry),E&4&&(v.scale=e[2]),m.$set(v);const L={};E&8&&(L.x=e[3].cx+e[3].rx),E&8&&(L.y=e[3].cy),E&4&&(L.scale=e[2]),u.$set(L);const B={};E&8&&(B.x=e[3].cx),E&8&&(B.y=e[3].cy+e[3].ry),E&4&&(B.scale=e[2]),T.$set(B);const j={};E&8&&(j.x=e[3].cx-e[3].rx),E&8&&(j.y=e[3].cy),E&4&&(j.scale=e[2]),$.$set(j)},i(P){I||(C(m.$$.fragment,P),C(u.$$.fragment,P),C(T.$$.fragment,P),C($.$$.fragment,P),I=!0)},o(P){Q(m.$$.fragment,P),Q(u.$$.fragment,P),Q(T.$$.fragment,P),Q($.$$.fragment,P),I=!1},d(P){P&&(k(t),k(i),k(a),k(f),k(y),k(_),k(S)),ee(m,P),ee(u,P),ee(T,P),ee($,P),H=!1,le(R)}}}function Ao(e){let t,n;return t=new mt({props:{shape:e[0],transform:e[1],editor:e[4],$$slots:{default:[ko,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:e}}}),t.$on("grab",e[5]),t.$on("change",e[6]),t.$on("release",e[7]),{c(){se(t.$$.fragment)},m(o,s){Z(t,o,s),n=!0},p(o,[s]){const r={};s&1&&(r.shape=o[0]),s&2&&(r.transform=o[1]),s&1548&&(r.$$scope={dirty:s,ctx:o}),t.$set(r)},i(o){n||(C(t.$$.fragment,o),n=!0)},o(o){Q(t.$$.fragment,o),n=!1},d(o){ee(t,o)}}}function Ho(e,t,n){let o,{shape:s}=t,{transform:r}=t,{viewportScale:i=1}=t;const a=(c,f,m)=>{const y=c.geometry.bounds;let[u,_]=[y.minX,y.minY],[T,S]=[y.maxX,y.maxY];const[$,I]=m;if(f==="SHAPE")u+=$,T+=$,_+=I,S+=I;else switch(f){case"TOP":{_+=I;break}case"BOTTOM":{S+=I;break}case"LEFT":{u+=$;break}case"RIGHT":{T+=$;break}}const H=Math.min(u,T),R=Math.min(_,S),P=Math.abs(T-u),E=Math.abs(S-_),v=(u+T)/2,L=(_+S)/2,B=P/2,j=E/2;return{...c,geometry:{...c.geometry,cx:v,cy:L,rx:B,ry:j,bounds:{minX:H,minY:R,maxX:H+P,maxY:R+E}}}};function l(c){oe.call(this,e,c)}function d(c){oe.call(this,e,c)}function p(c){oe.call(this,e,c)}return e.$$set=c=>{"shape"in c&&n(0,s=c.shape),"transform"in c&&n(1,r=c.transform),"viewportScale"in c&&n(2,i=c.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(3,o=s.geometry),e.$$.dirty&4},[s,r,i,o,a,l,d,p]}class Lo extends je{constructor(t){super(),Ye(this,t,Ho,Ao,Ge,{shape:0,transform:1,viewportScale:2})}}function en(e){let t,n,o,s,r,i,a,l,d,p;return{c(){t=F("ellipse"),i=F("ellipse"),h(t,"class","a9s-outer"),h(t,"cx",n=e[2]+e[4]/2),h(t,"cy",o=e[3]+e[5]/2),h(t,"rx",s=e[4]/2),h(t,"ry",r=e[5]/2),h(i,"class","a9s-inner"),h(i,"cx",a=e[2]+e[4]/2),h(i,"cy",l=e[3]+e[5]/2),h(i,"rx",d=e[4]/2),h(i,"ry",p=e[5]/2)},m(c,f){A(c,t,f),A(c,i,f)},p(c,f){f&20&&n!==(n=c[2]+c[4]/2)&&h(t,"cx",n),f&40&&o!==(o=c[3]+c[5]/2)&&h(t,"cy",o),f&16&&s!==(s=c[4]/2)&&h(t,"rx",s),f&32&&r!==(r=c[5]/2)&&h(t,"ry",r),f&20&&a!==(a=c[2]+c[4]/2)&&h(i,"cx",a),f&40&&l!==(l=c[3]+c[5]/2)&&h(i,"cy",l),f&16&&d!==(d=c[4]/2)&&h(i,"rx",d),f&32&&p!==(p=c[5]/2)&&h(i,"ry",p)},d(c){c&&(k(t),k(i))}}}function Ro(e){let t,n=e[1]&&en(e);return{c(){t=F("g"),n&&n.c(),h(t,"class","a9s-annotation a9s-rubberband")},m(o,s){A(o,t,s),n&&n.m(t,null),e[9](t)},p(o,[s]){o[1]?n?n.p(o,s):(n=en(o),n.c(),n.m(t,null)):n&&(n.d(1),n=null)},i:$e,o:$e,d(o){o&&k(t),n&&n.d(),e[9](null)}}}function Go(e,t,n){const o=Vt();let{addEventListener:s}=t,{drawingMode:r}=t,{transform:i}=t,a,l,d,p,c,f,m,y=!1,u=!1,_,T;const S=v=>{const L=v;_=performance.now(),r==="drag"&&(n(1,l=i.elementToImage(L.offsetX,L.offsetY)),d=l,n(2,p=l[0]),n(3,c=l[1]),n(4,f=1),n(5,m=1))},$=v=>{const L=v||T;if(l)if(d=i.elementToImage(L.offsetX,L.offsetY),u){const B=2*Math.abs(d[0]-l[0]),j=2*Math.abs(d[1]-l[1]);n(4,f=y?Math.max(B,j):B),n(5,m=y?f:j),n(2,p=Math.min(d[0],l[0]-f/2)),n(3,c=Math.min(d[1],l[1]-m/2))}else{const B=Math.abs(d[0]-l[0]),j=Math.abs(d[1]-l[1]);n(4,f=y?Math.max(B,j):B),n(5,m=y?f:j),n(2,p=Math.min(d[0],l[0])),n(3,c=Math.min(d[1],l[1]))}v&&(T=v)},I=v=>{const L=v;r==="click"&&L.stopImmediatePropagation();const B=performance.now()-_;if(r==="click"){if(B>300)return;L.stopPropagation(),l?H():(n(1,l=i.elementToImage(L.offsetX,L.offsetY)),d=l,n(2,p=l[0]),n(3,c=l[1]),n(4,f=1),n(5,m=1))}else l&&(B>300||f*m>100?(L.stopPropagation(),H()):(n(1,l=void 0),d=void 0,T=void 0))},H=()=>{if(f*m>15){const v={type:Te.ELLIPSE,geometry:{bounds:{minX:p,minY:c,maxX:p+f,maxY:c+m},cx:p+f/2,cy:c+m/2,rx:f/2,ry:m/2}};o("create",v)}n(1,l=void 0),d=void 0,T=void 0},R=v=>{v.key==="Shift"&&(y=!0,$()),v.key==="Control"&&(u=!0,$())},P=v=>{v.key==="Shift"&&(y=!1,$()),v.key==="Control"&&(u=!1,$())};Wn(()=>(document.addEventListener("keyup",P),document.addEventListener("keydown",R),s("pointerdown",S),s("pointermove",$),s("pointerup",I),()=>{document.removeEventListener("keyup",P),document.removeEventListener("keydown",R)}));function E(v){ft[v?"unshift":"push"](()=>{a=v,n(0,a)})}return e.$$set=v=>{"addEventListener"in v&&n(6,s=v.addEventListener),"drawingMode"in v&&n(7,r=v.drawingMode),"transform"in v&&n(8,i=v.transform)},[a,l,p,c,f,m,s,r,i,E]}class Bo extends je{constructor(t){super(),Ye(this,t,Go,Ro,Ge,{addEventListener:6,drawingMode:7,transform:8})}}const No=e=>{e.registerDrawingTool("ellipse",Bo),e.registerShapeEditor(Te.ELLIPSE,Lo)};te.mountPlugin=No,Object.defineProperty(te,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=annotorious-plugin-tools.js.map
